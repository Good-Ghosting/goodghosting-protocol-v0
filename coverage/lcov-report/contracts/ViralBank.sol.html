<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for contracts/ViralBank.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">contracts/</a> ViralBank.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">40.18% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>45/112</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">24.24% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>16/66</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">36.67% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>11/30</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">40% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>46/115</span>
      </div>
    </div>
  </div>
  <div class='status-line low'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">pragma solidity ^0.5.0;
&nbsp;
import "@openzeppelin/contracts/token/ERC20/IERC20.sol";
import "../aave/ILendingPoolAddressesProvider.sol";
import "../aave/ILendingPool.sol";
&nbsp;
/**
 * Play the save game.
 *
 * No safe math was though to shortcut the hacking time.
 *
 */
contract ViralBank is IERC20 {
&nbsp;
    // A short cut to figure out what this contract is doing
    // See getGmaeState()
    enum GameState {
        Starting,  // All players must do the first buy in with startGame()
        Playing,   // Monthly buy ins going with buyInMonthly()
        Cleaning,  // Need to manually call clean up for every player checkForDead()
        PayingOut  // Dividends are ready to be claimed with todo()
    }
&nbsp;
    // How one address is faring
    // See getPlayerState()
    enum PlayerState {
        NotPlaying, // Did not get in during incubation
        Playing,    // Has kept up with the payments
        DroppedOut, // Missed a payment
        Finished    // Made up to the finishing line
    }
&nbsp;
    // Token that patients use to buy in the game - DAI
    IERC20 public daiToken;
&nbsp;
    // Pointer to aDAI
    IERC20 public adaiToken;
&nbsp;
    // Which Aave instance we use to swap DAI to interest bearing aDAI
    ILendingPoolAddressesProvider public lendingPoolAddressProvider;
&nbsp;
    // What is the monthly payment and buy in
    // Now 9.90 DAI
    uint public ticketSize = 9.90 * 10**18;
&nbsp;
    // How many players started the journey
    uint public playerCount = 0;
&nbsp;
    // How many people made it - after clean up
    uint public finishedPlayerCount = 0;
&nbsp;
    // When the game started
    uint public startedAt = now;
&nbsp;
    // How long we want to play
    uint public constant ROUND_LENGTH = 7 days;
    uint public constant INCUBATION_PERIOD = ROUND_LENGTH; // Can't differ - simplified math
    uint public constant GAME_LENGTH = 52 * 7 days;
&nbsp;
    // Aave pays us kick back for DAI -&gt; aDAI conversion
    // https://developers.aave.com/#referral-program
    uint16 public constant AAVE_REFERRAL_CODE = 0;
&nbsp;
    // Book keeping
    address public patientZero;
    mapping(address =&gt; uint) public balances;
    uint public totalDeposits;
&nbsp;
    // Track if the player has been keeping up with the game
    mapping(address =&gt; uint) public lastActivityAt;
    mapping(address =&gt; uint) public lastRound;
&nbsp;
    //
    // Referral system
    //
&nbsp;
    // player who bought in -&gt; his/her referral
    mapping(address =&gt; address) public referrals;
    mapping(address =&gt; address) public reverseReferrals;
    mapping(address =&gt; uint) public referrerCount;
&nbsp;
    // how many interest shares each player has
    mapping(address =&gt; uint) public allocations;
    uint public totalAllocations = 0;
&nbsp;
    //
    // Final score calculations
    //
&nbsp;
    // Have we executed clean up for this player
    mapping(address =&gt; bool) public cleanedUp;
    uint public cleanedUpPlayerCount;
&nbsp;
    // How much shares for the prize pool was left after eliminating all the dead
    uint public aliveAllocations = 0;
&nbsp;
    // Withdrawal and interest handling
    uint totalWithdrawals = 0;
&nbsp;
    constructor(IERC20 _inboundCurrency, IERC20 _interestCurrency, ILendingPoolAddressesProvider _lendingPoolAddressProvider) public {
        daiToken = _inboundCurrency;
        adaiToken = _interestCurrency;
        lendingPoolAddressProvider = _lendingPoolAddressProvider;
&nbsp;
        // Allow lending pool convert DAI deposited on this contract to aDAI on lending pool
        uint MAX_ALLOWANCE = 2**256 - 1;
        address core = lendingPoolAddressProvider.getLendingPoolCore();
        daiToken.approve(core, MAX_ALLOWANCE);
    }
&nbsp;
// A new player joins the game
    function startGame(address referral) public {
&nbsp;
        <span class="missing-if-branch" title="else path not taken" >E</span>require(!isIncubationPeriodOver(), "Cannot come in after the pets have escaped the lab");
        <span class="missing-if-branch" title="else path not taken" >E</span>require(areWeHavingFun(), "Game has ended");
&nbsp;
        if(playerCount == 0) {
            // Patient zero
            <span class="missing-if-branch" title="else path not taken" >E</span>require(referral == address(0), "Patient zero has no referral");
            patientZero = msg.sender;
        } else {
            <span class="missing-if-branch" title="else path not taken" >E</span>require(referral != address(0), "All players must have a referral");
            <span class="missing-if-branch" title="else path not taken" >E</span>require(isPlayerInGame(referral), "Dead players cannot refer");
&nbsp;
            // Referring player gets 10% interested earned by this player
            allocations[referral] += 10;
            totalAllocations += 10;
        }
&nbsp;
        <span class="missing-if-branch" title="else path not taken" >E</span>require(lastRound[msg.sender] == 0, "Need to start at round zero");
        _buyIn();
&nbsp;
        playerCount++;
&nbsp;
        referrals[msg.sender] = referral;
&nbsp;
        // Superinfecter board update
        // TODO: Emit a sorted event?
        referrerCount[referral] += 1;
&nbsp;
        // This player gets full interest for themselves
        allocations[msg.sender] += 100;
        totalAllocations += 100;
&nbsp;
        // Second level multi marketing pyramid
        address secondLevel = referrals[referral];
        <span class="missing-if-branch" title="if path not taken" >I</span>if(secondLevel != address(0)) {
            // Second level referrers give you 1% of their interest
<span class="cstat-no" title="statement not covered" >            allocations[secondLevel] += 1</span>;
<span class="cstat-no" title="statement not covered" >            totalAllocations += 1</span>;
        }
    }
&nbsp;
    // Need to hit this every month or you are out of the game
    function buyInToRound() public {
        <span class="missing-if-branch" title="else path not taken" >E</span>require(areWeHavingFun(), "Game has ended");
        <span class="missing-if-branch" title="else path not taken" >E</span>require(isPlayerAddress(msg.sender), "You are not a player");
        <span class="missing-if-branch" title="else path not taken" >E</span>require(isPlayerInGame(msg.sender), "You have dropped off.");
&nbsp;
        // Check that the user has completed all the previous rounds
        <span class="missing-if-branch" title="if path not taken" >I</span>if(getCurrentRoundNumber() != 0) {
<span class="cstat-no" title="statement not covered" >            require(lastRound[msg.sender] == getCurrentRoundNumber() - 1, "You need to be on the previous round to buy in the next one")</span>;
        }
&nbsp;
        _buyIn();
    }
&nbsp;
    // Transaction sender updates his playing stats and money gets banked
    function _buyIn() internal {
&nbsp;
        _convertDAItoADAI(msg.sender, ticketSize);
&nbsp;
        lastActivityAt[msg.sender] = now;
        lastRound[msg.sender] = getCurrentRoundNumber();
        balances[msg.sender] += ticketSize;
        totalDeposits += ticketSize;
&nbsp;
        allocations[msg.sender] = 0;
    }
&nbsp;
    //User is leaving the game. Clean user state and redeem DAI
<span class="fstat-no" title="function not covered" >    function dropout() externa</span>l {
<span class="cstat-no" title="statement not covered" >        require(areWeHavingFun(), 'Game is not running')</span>;
<span class="cstat-no" title="statement not covered" >        require(isPlayerAddress(msg.sender), 'Not a player')</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >        uint _balance = balances[msg.sender];</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >        balances[msg.sender] = 0</span>;
<span class="cstat-no" title="statement not covered" >        totalWithdrawals += _balance</span>;
<span class="cstat-no" title="statement not covered" >        aliveAllocations -= allocations[msg.sender]</span>;
<span class="cstat-no" title="statement not covered" >        address _secondLevel = referrals[msg.sender];</span>
<span class="cstat-no" title="statement not covered" >        if(_secondLevel != address(0)) {</span>
<span class="cstat-no" title="statement not covered" >            allocations[msg.sender] -= 100</span>;
            // Second level referrers lost -1% of their interest
<span class="cstat-no" title="statement not covered" >            allocations[_secondLevel] -= 1</span>;
<span class="cstat-no" title="statement not covered" >            totalAllocations -= 1</span>;
            delete referrals[msg.sender];
        } else {
<span class="cstat-no" title="statement not covered" >            allocations[msg.sender] -= 100</span>;
        }
&nbsp;
&nbsp;
<span class="cstat-no" title="statement not covered" >        allocations[reverseReferrals[msg.sender]] -= 10</span>;
        delete reverseReferrals[msg.sender];
<span class="cstat-no" title="statement not covered" >        totalAllocations -= 100</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >        cleanedUp[msg.sender] = true</span>;
<span class="cstat-no" title="statement not covered" >        _convertADAItoDAI(msg.sender, _balance)</span>;
    }
&nbsp;
    //Collect the balance plus interest if ended the game
<span class="fstat-no" title="function not covered" >    function _withdraw() interna</span>l {
<span class="cstat-no" title="statement not covered" >        require(areWeHavingFun(), 'Game is running')</span>;
        //TODO: Review this
<span class="cstat-no" title="statement not covered" >        require(isCleanUpComplete(), 'Cleanup is not complete')</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >        uint256 _amount = balances[msg.sender] + getPlayerShareOfAccruedInterest(msg.sender);</span>
<span class="cstat-no" title="statement not covered" >        balances[msg.sender] = 0</span>;
<span class="cstat-no" title="statement not covered" >        allocations[msg.sender] = 0</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >        totalWithdrawals -= _amount</span>;
<span class="cstat-no" title="statement not covered" >        _convertADAItoDAI(msg.sender, _amount)</span>;
    }
&nbsp;
&nbsp;
    // Swap DAI to interest bearing aDAI token
    // How to convert DAI to ADAI
    // Note separation between lending pole CORE (approval target) and lending poo linstance
    // 1. User needs to make approve() against this smart contractt
    // 2. This smart contract has approves Aave lending pool CORE to tranferFrom() DAI from this cotract to core
    // 3. We call deposit() which will trigger transferFrom(), move DAI from this contract and generate aDAI on this contract
    function _convertDAItoADAI(address whose, uint amount) internal {
&nbsp;
        ILendingPool lendingPool = ILendingPool(lendingPoolAddressProvider.getLendingPool());
&nbsp;
        <span class="missing-if-branch" title="else path not taken" >E</span>require(daiToken.allowance(whose, address(this)) &gt;= amount, "You need to have allowance to do transfer DAI on the smart contract");
&nbsp;
        // Move DAI from user wallet to this contract
        <span class="missing-if-branch" title="else path not taken" >E</span>require(daiToken.transferFrom(whose, address(this), amount) == true, "Transfer failed");
&nbsp;
        // https://developers.aave.com/#lendingpool
        // https://github.com/aave/aave-protocol/blob/master/test/atoken-transfer.spec.ts#L39
&nbsp;
        // Move DAI form this contract to lending pool
        // See approve() in the constructor
        lendingPool.deposit(address(daiToken), amount, AAVE_REFERRAL_CODE);
    }
&nbsp;
    // Swap ADAI back to DAI
    // ADAI is burn and the whose DAI balance is incressed
    // Note: validations should be in place before call this method.
<span class="fstat-no" title="function not covered" >    function _convertADAItoDAI(address whose, uint amount) interna</span>l {
&nbsp;
<span class="cstat-no" title="statement not covered" >        ILendingPool lendingPool = ILendingPool(lendingPoolAddressProvider.getLendingPool());</span>
        //External call
        //Burn tokens and collect DAI
<span class="cstat-no" title="statement not covered" >        lendingPool.redeem(amount)</span>;
        //External call
        //Send tokens to user account
<span class="cstat-no" title="statement not covered" >        daiToken.transfer(whose, amount)</span>;
    }
&nbsp;
    // Remove allocations for players who failed
    // A state clean up when before the final dividend.
    // Must be manually called for every player
    // https://www.youtube.com/watch?v=GU0d8kpybVg
<span class="fstat-no" title="function not covered" >    function checkForDead(address addr) publi</span>c {
&nbsp;
<span class="cstat-no" title="statement not covered" >        require(!areWeHavingFun(), "Game still goes on")</span>;
<span class="cstat-no" title="statement not covered" >        require(isPlayerAddress(addr), "Was not a player")</span>;
<span class="cstat-no" title="statement not covered" >        require(cleanedUp[addr] == false, "Player has already been cleaned up")</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >        if(aliveAllocations == 0) {</span>
<span class="cstat-no" title="statement not covered" >            aliveAllocations = totalAllocations</span>;
        }
&nbsp;
        // Player failed, no prize for them
<span class="cstat-no" title="statement not covered" >        if(!hasPlayerFinishedGame(addr)) {</span>
<span class="cstat-no" title="statement not covered" >            aliveAllocations -= allocations[addr]</span>;
<span class="cstat-no" title="statement not covered" >            allocations[addr] = 0</span>;
        } else {
            finishedPlayerCount++;
        }
&nbsp;
        cleanedUpPlayerCount++;
<span class="cstat-no" title="statement not covered" >        cleanedUp[addr] = true</span>;
    }
&nbsp;
    // Check for the game master
    function isPatientZero(address addr) public view returns(bool) {
        return addr == patientZero;
    }
&nbsp;
    // Cannot come in after incubation perios is over
    function isIncubationPeriodOver() public view returns(bool) {
        return now &gt; startedAt + INCUBATION_PERIOD;
    }
&nbsp;
    // Did this player play the game in some point
    // 1. Still playing
    // 2. Was playing / withdraw
    // 3. Was playing / dropped out
    function isPlayerAddress(address addr) public view returns(bool) {
        return isPatientZero(addr) || referrals[addr] != address(0);
    }
&nbsp;
    /** The player has started the game and has not dropped out */
    function isPlayerInGame(address addr) public view returns(bool) {
        <span class="missing-if-branch" title="else path not taken" >E</span>if(getCurrentRoundNumber() == 0) {
            return balances[addr] &gt; 0;
        } else {
            // Player is on the current or previous round
<span class="cstat-no" title="statement not covered" >            return (getCurrentRoundNumber() - lastRound[addr]) &lt;= 1;</span>
        }
    }
&nbsp;
    // Zero for the incubation, 12 is when the game ends
    function getCurrentRoundNumber() public view returns(uint) {
        return (now - startedAt) / ROUND_LENGTH;
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function getLastRoundNumber() public pure returns(uint</span>) {
<span class="cstat-no" title="statement not covered" >        return GAME_LENGTH / ROUND_LENGTH;</span>
    }
&nbsp;
    // When the next round of deposits needs to get in,
<span class="fstat-no" title="function not covered" >    function getNextDepositStarts() public view returns(uint</span>) {
<span class="cstat-no" title="statement not covered" >        return startedAt + (getCurrentRoundNumber() * ROUND_LENGTH);</span>
    }
&nbsp;
    // How long until the players can still deposito on this round
<span class="fstat-no" title="function not covered" >    function getDepositDeadline() public view returns(uint</span>) {
<span class="cstat-no" title="statement not covered" >        return getNextDepositStarts();</span>
    }
&nbsp;
    // Is the game going
    function areWeHavingFun() public view returns(bool) {
        return now &lt; startedAt + GAME_LENGTH;
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function hasPlayerFinishedGame(address addr) public view returns(bool</span>) {
<span class="cstat-no" title="statement not covered" >        require(isPlayerAddress(addr), "Not a player")</span>;
<span class="cstat-no" title="statement not covered" >        return lastRound[addr] == getLastRoundNumber();</span>
    }
&nbsp;
    // Have we checked all the players if they made it to the finish line
<span class="fstat-no" title="function not covered" >    function isCleanUpComplete() public view returns(bool</span>) {
<span class="cstat-no" title="statement not covered" >        return cleanedUpPlayerCount == playerCount;</span>
    }
&nbsp;
    // Determine in which state the game is currently,
<span class="fstat-no" title="function not covered" >    function getGameState() public view returns(GameState</span>) {
<span class="cstat-no" title="statement not covered" >        if(!isIncubationPeriodOver()) {</span>
<span class="cstat-no" title="statement not covered" >            return GameState.Starting;</span>
        } else <span class="cstat-no" title="statement not covered" >if(areWeHavingFun()) {</span>
<span class="cstat-no" title="statement not covered" >            return GameState.Playing;</span>
        } else <span class="cstat-no" title="statement not covered" >if(!isCleanUpComplete()) {</span>
<span class="cstat-no" title="statement not covered" >            return GameState.Cleaning;</span>
        } else {
<span class="cstat-no" title="statement not covered" >            return GameState.PayingOut;</span>
        }
    }
&nbsp;
    // Figure out what is the state of a single player
<span class="fstat-no" title="function not covered" >    function getPlayerState(address addr) public view returns(PlayerState</span>) {
&nbsp;
<span class="cstat-no" title="statement not covered" >        if(!isPlayerAddress(addr)) {</span>
<span class="cstat-no" title="statement not covered" >            return PlayerState.NotPlaying;</span>
        }
&nbsp;
<span class="cstat-no" title="statement not covered" >        if(!hasPlayerFinishedGame(addr)) {</span>
<span class="cstat-no" title="statement not covered" >            return PlayerState.Finished;</span>
        }
&nbsp;
<span class="cstat-no" title="statement not covered" >        if(!isPlayerInGame(addr)) {</span>
<span class="cstat-no" title="statement not covered" >            return PlayerState.DroppedOut;</span>
        }
&nbsp;
<span class="cstat-no" title="statement not covered" >        return PlayerState.Playing;</span>
    }
&nbsp;
    // How much interest the game has collected
<span class="fstat-no" title="function not covered" >    function getTotalAccruedInterest() public view returns(uint</span>) {
<span class="cstat-no" title="statement not covered" >        return adaiToken.balanceOf(address(this)) - totalDeposits - totalWithdrawals;</span>
    }
&nbsp;
    // How much one player owns from the pot
    // (Does not account for dead players)
<span class="fstat-no" title="function not covered" >    function getPlayerShareOfAccruedInterest(address addr) public view returns(uint</span>) {
<span class="cstat-no" title="statement not covered" >        return getTotalAccruedInterest() * totalAllocations / allocations[addr];</span>
    }
&nbsp;
    //
    // ERC-20 dummy interface to show how much allocation each person has
    //
&nbsp;
    string public name = "Viral Aave";
    string public symbol = "vDAI";
    uint8 public decimals = 18;
&nbsp;
<span class="fstat-no" title="function not covered" >    function totalSupply() external view returns (uint256</span>) {
<span class="cstat-no" title="statement not covered" >        return getTotalAccruedInterest();</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function balanceOf(address account) external view returns (uint256</span>) {
<span class="cstat-no" title="statement not covered" >        return getTotalAccruedInterest() * allocations[account] / totalAllocations;</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function transfer(address, uint256) external returns (bool</span>) {
<span class="cstat-no" title="statement not covered" >        return false;</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function allowance(address, address) external view returns (uint256</span>) {
<span class="cstat-no" title="statement not covered" >        return 0;</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function approve(address, uint256) external returns (bool</span>) {
<span class="cstat-no" title="statement not covered" >        return false;</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function transferFrom(address, address, uint256) external returns (bool</span>) {
<span class="cstat-no" title="statement not covered" >        return false;</span>
    }
}
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Fri Mar 06 2020 13:38:32 GMT+0000 (Western European Standard Time)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
